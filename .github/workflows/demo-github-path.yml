name: "DEMO - Explicaci√≥n de GITHUB_PATH"

# Este workflow demuestra c√≥mo funciona GITHUB_PATH de forma pr√°ctica

on:
  workflow_dispatch:

jobs:
  # ============================================================================
  # Ejemplo 1: Sin usar GITHUB_PATH (FALLA)
  # ============================================================================
  sin-github-path:
    name: "‚ùå SIN GITHUB_PATH (fallar√°)"
    runs-on: ubuntu-latest
    continue-on-error: true  # Continuar aunque falle
    
    steps:
      - name: "Crear un script personalizado"
        run: |
          echo "üìù Creando script personalizado..."
          
          # Crear directorio para nuestros scripts
          mkdir -p $HOME/mis-scripts
          
          # Crear un script que dice hola
          cat > $HOME/mis-scripts/saludar << 'EOF'
          #!/bin/bash
          echo "üëã ¬°Hola! Soy un comando personalizado"
          echo "üìç Ubicaci√≥n: $HOME/mis-scripts/saludar"
          EOF
          
          # Darle permisos de ejecuci√≥n
          chmod +x $HOME/mis-scripts/saludar
          
          echo "‚úÖ Script creado en: $HOME/mis-scripts/saludar"
      
      - name: "Intentar ejecutar el comando (FALLAR√Å)"
        run: |
          echo "üîç Intentando ejecutar: saludar"
          saludar  # ‚ùå Esto fallar√° porque el sistema no sabe d√≥nde est√°
        continue-on-error: true
      
      - name: "Explicaci√≥n del error"
        if: always()
        run: |
          cat << 'EOF'
          
          ‚ùå ERROR ESPERADO
          ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          El comando "saludar" no se encuentra porque:
          
          1. El sistema busca comandos en directorios del PATH
          2. $HOME/mis-scripts NO est√° en el PATH
          3. Por eso el sistema no puede encontrar "saludar"
          
          Soluci√≥n: Agregar $HOME/mis-scripts al PATH
          ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          EOF
      
      - name: "Alternativa: Usar ruta completa (funciona)"
        run: |
          echo "‚úÖ Usando ruta completa:"
          $HOME/mis-scripts/saludar  # ‚úÖ Esto S√ç funciona

  # ============================================================================
  # Ejemplo 2: CON GITHUB_PATH (FUNCIONA)
  # ============================================================================
  con-github-path:
    name: "‚úÖ CON GITHUB_PATH (funciona)"
    runs-on: ubuntu-latest
    
    steps:
      - name: "Paso 1: Crear script personalizado"
        run: |
          echo "üìù Creando script personalizado..."
          
          mkdir -p $HOME/mis-scripts
          
          cat > $HOME/mis-scripts/saludar << 'EOF'
          #!/bin/bash
          echo "üëã ¬°Hola! Soy un comando personalizado"
          echo "üìç Me encuentran porque estoy en el PATH"
          EOF
          
          chmod +x $HOME/mis-scripts/saludar
          
          echo "‚úÖ Script creado"
      
      - name: "Paso 2: Agregar directorio al PATH"
        run: |
          echo "‚ûï Agregando directorio al PATH..."
          echo "$HOME/mis-scripts" >> $GITHUB_PATH
          echo "‚úÖ Directorio agregado al PATH"
      
      - name: "Paso 3: Usar el comando directamente"
        run: |
          echo "üöÄ Ejecutando: saludar"
          saludar  # ‚úÖ Ahora S√ç funciona!
      
      - name: "Explicaci√≥n"
        run: |
          cat << 'EOF'
          
          ‚úÖ FUNCION√ì
          ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          El comando "saludar" funciona porque:
          
          1. Agregamos $HOME/mis-scripts al PATH
          2. Ahora el sistema busca comandos ah√≠
          3. Encuentra "saludar" autom√°ticamente
          
          Ya no necesitamos la ruta completa!
          ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          EOF

  # ============================================================================
  # Ejemplo 3: Caso Real - Instalar una herramienta
  # ============================================================================
  ejemplo-real:
    name: "üîß Ejemplo Real"
    runs-on: ubuntu-latest
    
    steps:
      - name: "Descargar e instalar herramienta"
        run: |
          echo "üì¶ Descargando herramienta..."
          
          # Crear directorio para herramientas
          mkdir -p /tmp/tools
          
          # Simular descarga de una herramienta
          # En la vida real ser√≠a: wget https://...
          cat > /tmp/tools/miherramienta << 'EOF'
          #!/bin/bash
          echo "üõ†Ô∏è MiHerramienta v1.0.0"
          echo "Argumentos recibidos: $@"
          EOF
          
          chmod +x /tmp/tools/miherramienta
          
          echo "‚úÖ Herramienta instalada en /tmp/tools"
      
      - name: "Agregar al PATH"
        run: echo "/tmp/tools" >> $GITHUB_PATH
      
      - name: "Usar la herramienta en m√∫ltiples steps"
        run: |
          echo "Step 1: Usando miherramienta"
          miherramienta --help
      
      - name: "Otro step - la herramienta sigue disponible"
        run: |
          echo "Step 2: A√∫n funciona!"
          miherramienta --version
      
      - name: "Y en otro step m√°s"
        run: |
          echo "Step 3: Todav√≠a disponible!"
          miherramienta build --prod

  # ============================================================================
  # Ejemplo 4: M√∫ltiples directorios en PATH
  # ============================================================================
  multiples-directorios:
    name: "üìÇ M√∫ltiples Directorios"
    runs-on: ubuntu-latest
    
    steps:
      - name: "Crear m√∫ltiples scripts en diferentes directorios"
        run: |
          # Directorio 1
          mkdir -p /tmp/scripts1
          echo '#!/bin/bash' > /tmp/scripts1/comando1
          echo 'echo "Comando 1 desde /tmp/scripts1"' >> /tmp/scripts1/comando1
          chmod +x /tmp/scripts1/comando1
          
          # Directorio 2
          mkdir -p /tmp/scripts2
          echo '#!/bin/bash' > /tmp/scripts2/comando2
          echo 'echo "Comando 2 desde /tmp/scripts2"' >> /tmp/scripts2/comando2
          chmod +x /tmp/scripts2/comando2
          
          # Directorio 3
          mkdir -p /tmp/scripts3
          echo '#!/bin/bash' > /tmp/scripts3/comando3
          echo 'echo "Comando 3 desde /tmp/scripts3"' >> /tmp/scripts3/comando3
          chmod +x /tmp/scripts3/comando3
      
      - name: "Agregar todos los directorios al PATH"
        run: |
          echo "/tmp/scripts1" >> $GITHUB_PATH
          echo "/tmp/scripts2" >> $GITHUB_PATH
          echo "/tmp/scripts3" >> $GITHUB_PATH
      
      - name: "Usar todos los comandos"
        run: |
          echo "Ejecutando comandos de diferentes directorios:"
          comando1
          comando2
          comando3
          echo "‚úÖ Todos funcionan!"

  # ============================================================================
  # Resumen Final
  # ============================================================================
  resumen:
    name: "üìä Resumen"
    runs-on: ubuntu-latest
    needs: [sin-github-path, con-github-path, ejemplo-real, multiples-directorios]
    if: always()
    
    steps:
      - name: "Generar resumen"
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          # üìö Explicaci√≥n de GITHUB_PATH
          
          ## ¬øQu√© es PATH?
          
          **PATH** es una variable de entorno que contiene una lista de directorios donde el sistema operativo busca comandos ejecutables.
          
          ### Ejemplo Visual:
          ```
          PATH=/usr/bin:/usr/local/bin:/home/user/bin
                  ‚Üì           ‚Üì                ‚Üì
             Busca aqu√≠   Y aqu√≠         Y aqu√≠ tambi√©n
          ```
          
          ## ¬øQu√© hace `$GITHUB_PATH`?
          
          Cuando escribes:
          ```bash
          echo "/mi/directorio" >> $GITHUB_PATH
          ```
          
          Est√°s diciendo: "Agrega `/mi/directorio` a la lista de lugares donde buscar comandos"
          
          ## Flujo Completo
          
          ### ‚ùå Sin GITHUB_PATH
          ```yaml
          - run: |
              mkdir -p $HOME/bin
              echo 'echo "Hola"' > $HOME/bin/saludo
              chmod +x $HOME/bin/saludo
          
          - run: saludo  # ‚ùå Error: comando no encontrado
          ```
          
          **¬øPor qu√© falla?**
          - El sistema busca "saludo" en PATH
          - PATH no incluye `$HOME/bin`
          - No encuentra el comando
          
          ### ‚úÖ Con GITHUB_PATH
          ```yaml
          - run: |
              mkdir -p $HOME/bin
              echo 'echo "Hola"' > $HOME/bin/saludo
              chmod +x $HOME/bin/saludo
              echo "$HOME/bin" >> $GITHUB_PATH  # ‚≠ê Agregar al PATH
          
          - run: saludo  # ‚úÖ Funciona!
          ```
          
          **¬øPor qu√© funciona?**
          - Agregamos `$HOME/bin` al PATH
          - Ahora el sistema busca ah√≠ tambi√©n
          - Encuentra "saludo" autom√°ticamente
          
          ## Casos de Uso Comunes
          
          ### 1. Instalar herramienta personalizada
          ```yaml
          - run: |
              wget https://releases.example.com/tool
              mv tool /usr/local/bin/
              chmod +x /usr/local/bin/tool
              echo "/usr/local/bin" >> $GITHUB_PATH
          
          - run: tool --version  # ‚úÖ Funciona en todos los steps siguientes
          ```
          
          ### 2. Scripts del proyecto
          ```yaml
          - uses: actions/checkout@v4
          - run: echo "${{ github.workspace }}/scripts" >> $GITHUB_PATH
          - run: mi-script.sh  # Scripts del repo disponibles
          ```
          
          ### 3. Herramientas en subdirectorios
          ```yaml
          - run: |
              npm install -g mypackage
              echo "$(npm prefix -g)/bin" >> $GITHUB_PATH
          
          - run: mypackage build  # Disponible globalmente
          ```
          
          ## Ventajas
          
          ‚úÖ **Conveniencia:** No necesitas rutas completas
          ```bash
          # Sin PATH
          /home/runner/tools/mycommand arg1 arg2
          
          # Con PATH
          mycommand arg1 arg2
          ```
          
          ‚úÖ **Persistencia:** Disponible en TODOS los steps siguientes
          
          ‚úÖ **Limpieza:** C√≥digo m√°s legible
          
          ## Alternativas
          
          ### 1. Usar ruta completa (sin PATH)
          ```yaml
          - run: $HOME/bin/comando  # Funciona pero verbose
          ```
          
          ### 2. Alias (solo en el mismo step)
          ```yaml
          - run: |
              alias cmd='$HOME/bin/comando'
              cmd  # Solo funciona en este step
          ```
          
          ### 3. Funci√≥n (solo en el mismo step)
          ```yaml
          - run: |
              cmd() { $HOME/bin/comando "$@"; }
              cmd  # Solo funciona en este step
          ```
          
          ## Comparaci√≥n de Resultados
          
          | Job | Resultado | Explicaci√≥n |
          |-----|-----------|-------------|
          | Sin GITHUB_PATH | ${{ needs.sin-github-path.result }} | Falla al buscar comando |
          | Con GITHUB_PATH | ${{ needs.con-github-path.result }} | Funciona correctamente |
          | Ejemplo Real | ${{ needs.ejemplo-real.result }} | Uso pr√°ctico |
          | M√∫ltiples Dirs | ${{ needs.multiples-directorios.result }} | Varios comandos |
          
          ## üí° Resumen
          
          **GITHUB_PATH** = Agregar directorios donde el sistema busca comandos
          
          - Creas un script/herramienta
          - Lo pones en un directorio
          - Agregas ese directorio a PATH
          - Ahora puedes usar el comando desde cualquier lugar
          
          **Es como agregar un app a "Aplicaciones" en tu PC para accederla f√°cilmente** üéØ
          EOF
          
          echo "‚úÖ Workflow completado - Revisa el Step Summary arriba ‚¨ÜÔ∏è"

